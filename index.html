<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mobile Friendly Barcode Scanner</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 10px;
        background-color: #f8f8f8;
      }
      #reader {
        width: 100%;
        /* max-width: 600px; */
        margin: 20px auto;
        padding: 10px;
        border: 1px solid #ddd;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      #html5-qrcode-button-camera-permission {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-button-camera-start {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-button-camera-stop {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #ff0022;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-anchor-scan-type-change {
        display: inline-block;
        padding: 10px 20px;
        background-color: #6c757d;
        text-decoration: none !important;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .swal2-actions {
        margin: 1em 1.6em 0.3em;
      }
      .swal2-confirm {
        outline: none;
      }
      .fade-out {
        opacity: 0;
        /* transition: opacity 0.5s ease-out; */
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/select/2.0.2/css/select.dataTables.css" />

    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/select/2.0.2/js/dataTables.select.js"></script>
  </head>

  <body>
    <!-- Konten scanner -->
    <div id="reader"></div>
    <!-- Konten table -->
    <div class="mx-auto my-4 p-8 border border-gray-400 bg-white rounded-md shadow-md">
      <table id="myTable" class="display responsive text-left">
        <thead>
            <tr>
                <th>Nama Barang</th>
                <th>Harga</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Row 1 Data 1</td>
                <td>Row 1 Data 2</td>
            </tr>
            <tr>
                <td>Row 2 Data 1</td>
                <td>Row 2 Data 2</td>
            </tr>
        </tbody>
    </table>
    </div>
    <!-- Audio -->
    <audio id="scanSound" src="store-scanner-beep-90395.mp3" class="hidden"></audio>
  </body>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="html5-qrcode.min.js"></script>

  <!-- memuat data produk -->
  <script>
    let list_products;

    // Fungsi untuk mengambil data dari file JSON lokal dan menyimpannya ke variabel
    async function fetchProducts() {
      try {
        const response = await fetch("data_product.json");
        const data = await response.json();
        return data.products;
      } catch (error) {
        alert("Error fetching products:", error);
      }
    }

    // Memanggil fungsi fetchProducts dan menyimpan hasilnya ke variabel
    async function createProductVariable() {
      list_products = await fetchProducts();
    }

    createProductVariable();
  </script>

  <!-- datatables -->
   <script>
    $(document).ready( function () {
        $('#myTable').DataTable();
    } );
   </script>

  <!-- scanner -->
  <script>
    var sound = document.getElementById("scanSound");

    let html5QrcodeScanner;

    function onScanSuccess(decodedText, decodedResult) {
      if (list_products["products"].length > 0) {
        list_products["products"].forEach((product) => {
          if (decodedText == product.kode_produk) {
            html5QrcodeScanner.pause(); // Pause the scanner
            sound.currentTime = 0;
            sound.play();
            // tampilkan informasi produk
            Swal.fire({
              icon: "success",
              html: `
                <div class="flex flex-wrap gap-4 ">
                    <h4 class="w-full font-bold text-xl text-center">${product.nama_produk}</h4>
                    <p class="w-full text-gray-600 text-center">${product.harga}</p>
                </div>
                `,
            }).then(() => {
              html5QrcodeScanner.resume(); // Resume the scanner
            });
          }
        });
      } else {
        Swal.fire({
          title: "Error",
          text: "Data produk tidak ditemukan!",
          icon: "error",
        });
      }
    }

    function onScanFailure(error) {}

    document.addEventListener("DOMContentLoaded", function () {
      html5QrcodeScanner = new Html5QrcodeScanner("reader", {
        fps: 10,
        qrbox: {
          width: "100%",
          height: "100%",
        },
        aspectRatio: 1.0,
        // disableFlip: false // true if you only want to scan from the rear camera
      });
      html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    });
  </script>
</html>
