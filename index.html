<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mobile Friendly Barcode Scanner</title>
    <style>
      body {
        font-family: "Quattrocento Sans", sans-serif;
        font-weight: 400;
        font-size: medium;
        text-align: center;
        margin: 0;
        padding: 10px;
        background-color: #f8f8f8;
      }
      #reader {
        width: 100%;
        /* max-width: 600px; */
        margin: 20px auto;
        padding: 10px;
        border: 1px solid #ddd;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      #html5-qrcode-button-camera-permission {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-button-camera-start {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-button-camera-stop {
        display: inline-block;
        padding: 10px 20px;
        margin-bottom: 20px;
        text-decoration: underline;
        background-color: #ff0022;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #html5-qrcode-anchor-scan-type-change {
        display: inline-block;
        padding: 10px 20px;
        background-color: #6c757d;
        text-decoration: none !important;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .swal2-actions {
        margin: 1em 1.6em 0.3em;
      }
      .swal2-confirm {
        outline: none;
      }
      .fade-out {
        opacity: 0;
        /* transition: opacity 0.5s ease-out; */
      }

      #myTable.dataTable tbody tr:hover {
        background-color: yellow;
      }

      #myTable.dataTable tbody tr:focus {
        background-color: yellow;
      }
    </style>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Quattrocento+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="tailwind.css" />

    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/select/2.0.2/css/select.dataTables.css" />

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/select/2.0.2/js/dataTables.select.js"></script>
  </head>

  <body>
    <div class="mx-auto my-4 p-3 border border-gray-400 bg-white rounded-md shadow-md">
      <div class="font-bold text-4xl">Barasi</div>
      <div>Frozen Food</div>
    </div>
    <!-- Konten scanner -->
    <div id="reader"></div>
    <!-- Konten table -->
    <div class="mx-auto my-4 p-8 border border-gray-400 bg-white rounded-md shadow-md">
      <table id="myTable" class="display strip hover cell-border responsive text-left"></table>
    </div>
    <!-- Audio -->
    <audio id="scanSound" src="store-scanner-beep-90395.mp3" class="hidden"></audio>
  </body>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="html5-qrcode.min.js"></script>

  <!-- memuat data produk -->
  <script>
    let list_products;

    // Fungsi untuk mengambil data dari file JSON lokal dan menyimpannya ke variabel
    async function fetchProducts() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/internal8/tes/main/data_product.json");
        const data = await response.json();
        // buat datatables
        createDataTables(data);
        return data;
      } catch (error) {
        alert("Error fetching products:", error);
      }
    }

    // Memanggil fungsi fetchProducts dan menyimpan hasilnya ke variabel
    async function createProductVariable() {
      list_products = await fetchProducts();
    }
    $(document).ready(function () {
      createProductVariable();
    });
  </script>

  <!-- datatables -->
  <script>
    function createDataTables(data) {
      $("#myTable").DataTable({
        data: data["products"],
        columns: [
          // Define your table columns here
          {
            title: "Nama Produk",
            data: "nama_produk",
            render: function (data, type, row) {
              // Add renderer for property1
              if (row.apakah_harga_toko == "ya") {
                return `<div class="flex flex-row gap-2 items-center">
                    <svg id="icon-surveyed" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" aria-hidden="true" class="text-blue-800" aria-label="This app is verified" height="2em" width="2em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.403 12.652a3 3 0 000-5.304 3 3 0 00-3.75-3.751 3 3 0 00-5.305 0 3 3 0 00-3.751 3.75 3 3 0 000 5.305 3 3 0 003.75 3.751 3 3 0 005.305 0 3 3 0 003.751-3.75zm-2.546-4.46a.75.75 0 00-1.214-.883l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd"></path></svg>
                    <span class="font-bold"> ${data} </span>
                  </div>`;
              } else {
                return `<span class=""> ${data} </span>`;
              }
            },
          }, // Replace with your property names
          {
            title: "Harga",
            data: "harga",
            render: function (data, type, row) {
              // Add renderer for property1
              return `<span class="font-bold"> ${data} </span>`; // Format data with "Rp" prefix
            },
          }, // Replace with your property names
          // Add more columns as needed
        ],
        pageLength: 50,
      });
    }
  </script>

  <!-- scanner -->
  <script>
    var sound = document.getElementById("scanSound");

    let html5QrcodeScanner;

    function onScanSuccess(decodedText, decodedResult) {
      if (list_products["products"].length > 0) {
        list_products["products"].forEach((product) => {
          if (decodedText == product.kode_produk) {
            html5QrcodeScanner.pause(); // Pause the scanner
            sound.currentTime = 0;
            sound.play();
            // tampilkan informasi produk
            Swal.fire({
              icon: hargaTokoCheck(product.apakah_harga_toko),
              html: `
                <div class="flex flex-wrap gap-4 ">
                    <h4 class="w-full font-bold text-xl text-center">${product.nama_produk}</h4>
                    <p class="w-full text-gray-600 text-center">${product.harga}</p>
                </div>
                `,
              customClass: {
                confirmButton: "flex-1 bg-blue-600 text-white font-bold border-blue-600 py-2 px-4 rounded",
              },
              buttonsStyling: false,
            }).then(() => {
              html5QrcodeScanner.resume(); // Resume the scanner
            });
          }
        });
      } else {
        Swal.fire({
          title: "Server Error!",
          text: "Data produk gagal dimuat!",
          icon: "error",
        });
      }
    }

    function onScanFailure(error) {}

    document.addEventListener("DOMContentLoaded", function () {
      html5QrcodeScanner = new Html5QrcodeScanner("reader", {
        fps: 30,
        qrbox: {
          width: "100%",
          height: "100%",
        },
        aspectRatio: 1.0,
        // disableFlip: false // true if you only want to scan from the rear camera
      });
      html5QrcodeScanner.render(onScanSuccess, onScanFailure);
    });
  </script>

  <script>
    function hargaTokoCheck(apakah_harga_toko) {
      if (apakah_harga_toko == "ya") {
        return "success";
      } else {
        return "warning";
      }
    }
  </script>
</html>
